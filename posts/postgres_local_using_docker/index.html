<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Running PostgreSQL locally for back-end development using Docker</title>
<meta name=description content><meta name=keywords content='Containers,Postgres,Developer tools'><meta property="og:url" content="https://mahesh-hegde.github.io/posts/postgres_local_using_docker/"><meta property="og:type" content="website"><meta property="og:title" content="Running PostgreSQL locally for back-end development using Docker"><meta property="og:description" content><meta property="og:image" content="https://mahesh-hegde.github.io/"><meta property="og:image:secure_url" content="https://mahesh-hegde.github.io/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Running PostgreSQL locally for back-end development using Docker"><meta name=twitter:description content><meta property="twitter:domain" content="https://mahesh-hegde.github.io/posts/postgres_local_using_docker/"><meta property="twitter:url" content="https://mahesh-hegde.github.io/posts/postgres_local_using_docker/"><meta name=twitter:image content="https://mahesh-hegde.github.io/"><link rel=canonical href=https://mahesh-hegde.github.io/posts/postgres_local_using_docker/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.fbe2f55794ed6ded1573152a130784ee5cb022de9676b19dd37d7559ee6f6fc6.js integrity="sha256-++L1V5Ttbe0VcxUqEweE7lywIt6WdrGd0311We5vb8Y="></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://mahesh-hegde.github.io/>Mahesh's Blog</a></div><div class=nav-links><div class=nav-link><a href=https://mahesh-hegde.github.io/posts/>Posts</a></div><div class=nav-link><a href=https://mahesh-hegde.github.io/tags/>Tags</a></div><div class=nav-link><a href=https://mahesh-hegde.github.io/cv/>CV</a></div><div class=nav-link><a href=https://mahesh-hegde.github.io/readings/>Readings</a></div><div class=nav-link><a href=https://mahesh-hegde.github.io/about/>About</a></div><div class=nav-link><a href=mailto:net.mahesh29@gmail.com><span data-feather=mail></span></a></div><div class=nav-link><a href=https://github.com/mahesh-hegde><span data-feather=github></span></a></div><div class=nav-link><a href=https://www.linkedin.com/in/mahesh-bhaskar-hegde/><span data-feather=linkedin></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://mahesh-hegde.github.io/posts/>Posts</a></li><li class=nav-item><a href=https://mahesh-hegde.github.io/tags/>Tags</a></li><li class=nav-item><a href=https://mahesh-hegde.github.io/cv/>CV</a></li><li class=nav-item><a href=https://mahesh-hegde.github.io/readings/>Readings</a></li><li class=nav-item><a href=https://mahesh-hegde.github.io/about/>About</a></li><li class=nav-item><a href=mailto:net.mahesh29@gmail.com><span data-feather=mail></span></a></li><li class=nav-item><a href=https://github.com/mahesh-hegde><span data-feather=github></span></a></li><li class=nav-item><a href=https://www.linkedin.com/in/mahesh-bhaskar-hegde/><span data-feather=linkedin></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Running PostgreSQL locally for back-end development using Docker</h1><small role=doc-subtitle></small><p class=post-date>May 13, 2023</p><ul class=post-tags><li class=post-tag><a href=https://mahesh-hegde.github.io/tags/containers>Containers</a></li><li class=post-tag><a href=https://mahesh-hegde.github.io/tags/postgres>Postgres</a></li><li class=post-tag><a href=https://mahesh-hegde.github.io/tags/developer-tools>Developer tools</a></li></ul></div><div class=post-content><p><p>When doing back-end development or just fiddling with SQL, installing postgres the traditional way may not be very convenient for many reasons. This post describes how to run postgres for local development using docker and docker compose.</p><p>One important advantage for me is getting the latest version of postgres, since I tend to use a stable linux distribution.</p><p>There&rsquo;s already some amount of documentation for postgresql official docker image. But few things are less than obvious if you&rsquo;re a beginner like me.</p><h2 id=running-postgres-as-standalone-docker-container>Running postgres as standalone docker container</h2><p>First pull the docker container using</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull postgres
</span></span></code></pre></div><p>Only required configuration for running this image is POSTGRES_PASSWORD. We want to assign a name to this for ease of referring to it later. So this image can be run as</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --name postgres_db -e POSTGRES_PASSWORD<span style=color:#f92672>=</span>mypassword -d postgres
</span></span></code></pre></div><p>This is the command in official documentation. But this doesn&rsquo;t expose the postgres port. So you can only access it through psql in same container. (Note the default user is <code>postgres</code>, and default db name is also <code>postgres</code>. It can be overridden with environment variables <code>POSTGRES_USER</code> and <code>POSTGRES_DB</code> respectively).</p><p>This command gives a postgresql prompt, where you can run commands.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it postgres_db psql -U postgres
</span></span></code></pre></div><p>But to actually use this database from application code (or other clients), we need to expose the port 5432. Remove the old <code>postgres_db</code> container using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker stop postgres_db <span style=color:#f92672>&amp;&amp;</span> docker rm postgres_db
</span></span></code></pre></div><p>Now run the same command with port forwarding.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --name postgres_db -e POSTGRES_PASSWORD<span style=color:#f92672>=</span>mypassword -dp 127.0.0.1:5432:5432 postgres
</span></span></code></pre></div><p>This allows connecting to this database with external clients (For example <a href=https://github.com/dbcli/pgcli>pgcli</a>, which has nice features like autocompletion, syntax highlighting and various output formats).</p><p>More importantly, you can access this database from application code such as JDBC or Golang&rsquo;s <code>pq</code> driver.</p><p>Now you can connect to it using pgcli, and can use the same credentials in application code as well.</p><pre tabindex=0><code>pgcli -h localhost -u postgres -d postgres
</code></pre><p>Again, the default database name is <code>postgres</code> and it can be customized with <code>POSTGRES_DB</code> variable, eg: <code>-e POSTGRES_DB=books</code>.</p><h2 id=using-volumes-for-persistent-storage>Using volumes for persistent storage</h2><p>Above technique does not save data when container is removed using <code>docker rm</code>. For that, we have to use volumes.</p><p>First create a volume using</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker volume create postgres-data
</span></span></code></pre></div><p>Pass this volume when running docker command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --name postgres_db -e POSTGRES_PASSWORD<span style=color:#f92672>=</span>mypassword -dp 127.0.0.1:5432:5432<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-v postgres-data:/var/lib/postgresql/data postgres
</span></span></code></pre></div><h2 id=using-docker-compose>Using docker compose</h2><p>All above steps look a little manual, because they are.</p><p>We can use docker compose instead of specifying long commands every time. It also makes it easy to use other tools. To use docker compose, create a <code>docker-compose.yml</code> file with this configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.9&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>mysecretpassword</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgres-data:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>5432</span>:<span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres-data</span>:
</span></span></code></pre></div><p>Replace <code>mysecretpassword</code> by a password for local database. You can also refer to an environment variable in the configuration, which is arguably better than putting password in YAML.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>	<span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>		<span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#e6db74>&#34;${POSTGRES_PASSWORD}&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>## run `export POSTGRES_PASSWORD=mypassword` in shell</span>
</span></span></code></pre></div><p>After creating config, postgres server can be created by running the following command in the same directory as <code>docker-compose.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose up -d
</span></span></code></pre></div><p>To stop and remove the containers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose down
</span></span></code></pre></div><p>To delete storage volumes associated with the container, you should run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose down --volumes
</span></span></code></pre></div><h2 id=miscellaneous>Miscellaneous</h2><p>Golang <code>pq</code> driver requires to disable SSL explicitly. Add <code>sslmode=disable</code> in connection string when applicable to local setup.</p><p>Official docs also show using <code>adminer</code> in same compose file. Adminer (formerly <code>PhpMyAdmin</code>) is a popular web UI for many databases including postgres. To run adminer, add another service to the compose file. It will be available on <code>localhost:8080</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.9&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e>## ..postgres service from above config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>adminer</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>adminer</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>ADMINER_DEFAULT_SERVER</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>8080</span>:<span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## .. volumes from above config</span>
</span></span></code></pre></div><p>Many things can be configured using environment variables, refer to <a href=https://hub.docker.com/_/postgres>official documentation</a> for more details.</p></p></div><div class=prev-next></div></div></main><footer class=footer><span>&copy; 2024 Mahesh Hegde</span>
<span>Blog using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a> theme.</span></footer></body></html>