<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Usefulness of Go templates in command line tools</title><meta name=description content><meta name=keywords content="go,command line"><meta property="og:url" content="https://mahesh-hegde.github.io/posts/go_templates_in_command_line_tools/"><meta property="og:type" content="website"><meta property="og:title" content="Usefulness of Go templates in command line tools"><meta property="og:description" content><meta property="og:image" content="https://mahesh-hegde.github.io/"><meta property="og:image:secure_url" content="https://mahesh-hegde.github.io/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Usefulness of Go templates in command line tools"><meta name=twitter:description content><meta property="twitter:domain" content="https://mahesh-hegde.github.io/posts/go_templates_in_command_line_tools/"><meta property="twitter:url" content="https://mahesh-hegde.github.io/posts/go_templates_in_command_line_tools/"><meta name=twitter:image content="https://mahesh-hegde.github.io/"><link rel=canonical href=https://mahesh-hegde.github.io/posts/go_templates_in_command_line_tools/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.edd985581bf860dfb4507e5885197f1680160c7fe19f23b31e183126d99dd596.js integrity="sha256-7dmFWBv4YN+0UH5YhRl/FoAWDH/hnyOzHhgxJtmd1ZY="></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://mahesh-hegde.github.io/>Mahesh's Blog</a></div><div class=nav-links><div class=nav-link><a href=https://mahesh-hegde.github.io/posts/>Posts</a></div><div class=nav-link><a href=https://mahesh-hegde.github.io/tags/>Tags</a></div><div class=nav-link><a href=https://mahesh-hegde.github.io/about/>About</a></div><div class=nav-link><a href=mailto:net.mahesh29@gmail.com><span data-feather=mail></span></a></div><div class=nav-link><a href=https://github.com/mahesh-hegde><span data-feather=github></span></a></div><div class=nav-link><a href=https://www.linkedin.com/in/mahesh-bhaskar-hegde/><span data-feather=linkedin></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://mahesh-hegde.github.io/posts/>Posts</a></li><li class=nav-item><a href=https://mahesh-hegde.github.io/tags/>Tags</a></li><li class=nav-item><a href=https://mahesh-hegde.github.io/about/>About</a></li><li class=nav-item><a href=mailto:net.mahesh29@gmail.com><span data-feather=mail></span></a></li><li class=nav-item><a href=https://github.com/mahesh-hegde><span data-feather=github></span></a></li><li class=nav-item><a href=https://www.linkedin.com/in/mahesh-bhaskar-hegde/><span data-feather=linkedin></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Usefulness of Go templates in command line tools</h1><small role=doc-subtitle></small><p class=post-date>August 9, 2023</p><ul class=post-tags><li class=post-tag><a href=https://mahesh-hegde.github.io/tags/go>go</a></li><li class=post-tag><a href=https://mahesh-hegde.github.io/tags/command-line>command line</a></li></ul></div><div class=post-content><p><p>Almost every time I see <code>awk</code> in a shell script, it is to extract a particular column - like <code>awk '{print $1}'</code>.</p><p>Much has been written and said about how the plain text output of command line tools isn&rsquo;t very flexible. Therefore powershell uses an object paradigm, where nobody understands what is going on. It appears a few tools, like Azure CLI have just defaulted to printing JSON. But this also breaks some long-developed intuitions like using <code>grep</code> or other UNIX tools.</p><p>A happy middle ground is giving the user more control of formatting the output. Many tools like <code>docker</code> use Go templates syntax for this task. For those who don&rsquo;t use Go, its standard library ships with a text templating DSL (Domain Specific Language).</p><p>The original purpose of this DSL seems to be creating server rendered web pages. However, it has found some application in cloud-related command line tools.</p><p>For example, default output of <code>docker ps</code> looks something like this.</p><pre tabindex=0><code>$ docker ps
CONTAINER ID   IMAGE      COMMAND                  CREATED         STATUS         PORTS                      NAMES
5c645402c13c   postgres   &#34;docker-entrypoint.s…&#34;   4 seconds ago   Up 3 seconds   127.0.0.1:5432-&gt;5432/tcp   psql-postgres-1
2f2f4ace447a   adminer    &#34;entrypoint.sh php -…&#34;   4 seconds ago   Up 2 seconds   127.0.0.1:8080-&gt;8080/tcp   psql-adminer-1
</code></pre><p>This is a bit complicated output to parse. Suppose we only need to print image names for use by some other script or tool.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker ps --format <span style=color:#e6db74>&#39;{{.Image}}&#39;</span>
</span></span><span style=display:flex><span>adminer
</span></span><span style=display:flex><span>postgres
</span></span></code></pre></div><p>It&rsquo;s also possible for the command line tool&rsquo;s author to provide extra functions to be used in templates. Docker <a href=https://docs.docker.com/config/formatting/>provides a few</a>.</p><p>I have used the same pattern in a small command line tool I wrote. <a href=https://github.com/mahesh-hegde/rrip><code>rrip</code></a> is a command line tool which bulk-downloads images from Reddit. Using user-defined Go templates has been useful in quite a few places.</p><ul><li><p>rrip can log the posts it downloads to a file. Using go templates, you can provide a custom format for this.</p></li><li><p>Change the filename format. Default format is &ldquo;subreddit [post_id]&rdquo;, but user can specify a custom naming scheme using templates on command line.</p></li><li><p>Not just formatting but also filtering - you can provide a template as <code>--template-filter</code>. If this template evaluates to &ldquo;0&rdquo;, &ldquo;nil&rdquo; or &ldquo;false&rdquo;, the post will be skipped.</p></li></ul><p>Before writing the template, one will need to know which fields are there. In case of <code>docker</code>, you can pass <code>--format 'json'</code>. (Pipe the output to <code>jq</code> for neatly formatted and syntax-highlighted view) and inspect the available fields.</p><p>In case of <code>rrip</code> I implemented a <code>--print-post-data</code> option which prints the post JSON and does not really download it. So first you can inspect the JSON using this option, and know which fields are actually there.</p><pre tabindex=0><code>$ rrip --print-post-data --max-files=1 r/Wallpaper
{
  &#34;all_awardings&#34;: [],
  &#34;allow_live_comments&#34;: false,
  &#34;approved_at_utc&#34;: null,
  // ........................................... Output redacted
  &#34;ups&#34;: 163,
  &#34;upvote_ratio&#34;: 0.98,
  &#34;url&#34;: &#34;https://i.redd.it/6z7qmhwjrvgb1.png&#34;,
  &#34;url_overridden_by_dest&#34;: &#34;https://i.redd.it/6z7qmhwjrvgb1.png&#34;,
  &#34;user_reports&#34;: [],
  &#34;view_count&#34;: null,
  &#34;visited&#34;: false,
  &#34;whitelist_status&#34;: &#34;all_ads&#34;,
  &#34;wls&#34;: 6
}
Meep [3840x2160] [15lgw60].png                                                                      [Dry Run]
------------------------------------------------------------------------------------------------------------------------
Processed Posts:  1
Already Downloaded:  0
Failed:  0
Saved:  1
Other:  0
------------------------------------------------------------------------------------------------------------------------
Approx. Storage Used: 0B
------------------------------------------------------------------------------------------------------------------------
</code></pre><p>After knowning which fields are there, here are examples of few things we can do using templates.</p><pre tabindex=0><code>## Example: only download gilded posts
rrip --template-filter=&#39;{{gt .gilded 0.0}}&#39; --max-files=20 --sort=top-year r/Wallpapers

## Example: only download posts by a given author, say u/temporary_08
rrip --template-filter=&#39;{{eq .author &#34;temporary_08&#34;}}&#39; --max-files=20  r/AMOLEDBackgrounds

## Example: Log links to a file with author, upvote ratio, and quoted title.
## Use dry run (-d) to skip download
rrip -d --data-output-file=wallpaper.txt --data-output-format=&#39;{{.upvote_ratio}} {{.author}} {{.quoted_title}}&#39; r/Wallpapers

## Example: Change file name format using Go templates.
rrip --filename-format=&#39;{{.subreddit}} - {{.title}}&#39; --search &#34;Extraction 2&#34;
</code></pre><p>I find it to be a pretty useful DSL when writing or using command line programs in Go.</p></p></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>