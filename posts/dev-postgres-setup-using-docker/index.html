<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Postgres setup for local development using Docker - Mahesh's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Installing postgres the traditional way may not be very convenient for many reasons. This post describes how to run postgres for local development using docker and docker compose.
There&rsquo;s already some amount of documentation for postgresql official docker image. But few things are less than obvious if you&rsquo;re a beginner like me.
Running postgres as standalone docker container First pull the docker container using
docker pull postgres Only required configuration for running this image is POSTGRES_PASSWORD."><meta property="og:image" content><meta property="og:title" content="Postgres setup for local development using Docker"><meta property="og:description" content="Installing postgres the traditional way may not be very convenient for many reasons. This post describes how to run postgres for local development using docker and docker compose.
There&rsquo;s already some amount of documentation for postgresql official docker image. But few things are less than obvious if you&rsquo;re a beginner like me.
Running postgres as standalone docker container First pull the docker container using
docker pull postgres Only required configuration for running this image is POSTGRES_PASSWORD."><meta property="og:type" content="article"><meta property="og:url" content="https://mahesh-hegde.github.io/posts/dev-postgres-setup-using-docker/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-13T11:36:39+05:30"><meta property="article:modified_time" content="2023-05-13T11:36:39+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Postgres setup for local development using Docker"><meta name=twitter:description content="Installing postgres the traditional way may not be very convenient for many reasons. This post describes how to run postgres for local development using docker and docker compose.
There&rsquo;s already some amount of documentation for postgresql official docker image. But few things are less than obvious if you&rsquo;re a beginner like me.
Running postgres as standalone docker container First pull the docker container using
docker pull postgres Only required configuration for running this image is POSTGRES_PASSWORD."><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://mahesh-hegde.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://mahesh-hegde.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled></head><body><div class=content><header><div class=main><a href=https://mahesh-hegde.github.io/>Mahesh's Blog</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://mahesh-hegde.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>Postgres setup for local development using Docker</h1><div class=meta>Posted on May 13, 2023</div></div><section class=body><p>Installing postgres the traditional way may not be very convenient for many reasons. This post describes how to run postgres for local development using docker and docker compose.</p><p>There&rsquo;s already some amount of documentation for postgresql official docker image. But few things are less than obvious if you&rsquo;re a beginner like me.</p><h2 id=running-postgres-as-standalone-docker-container>Running postgres as standalone docker container</h2><p>First pull the docker container using</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull postgres
</span></span></code></pre></div><p>Only required configuration for running this image is POSTGRES_PASSWORD. We want to assign a name to this for ease of referring to it later. So this image can be run as</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --name postgres_db -e POSTGRES_PASSWORD<span style=color:#f92672>=</span>mypassword -d postgres
</span></span></code></pre></div><p>This is the command in official documentation. But this doesn&rsquo;t expose the postgres port. So you can only access it through psql in same container. (Note the default user is <code>postgres</code>, and default db name is also <code>postgres</code>. It can be overridden with environment variables <code>POSTGRES_USER</code> and <code>POSTGRES_DB</code> respectively).</p><p>This command gives a postgresql prompt, where you can run commands.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it postgres_db psql -U postgres
</span></span></code></pre></div><p>But to actually use this database from application code (or other clients), we need to expose the port 5432. Remove the old <code>postgres_db</code> container using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker stop postgres_db <span style=color:#f92672>&amp;&amp;</span> docker rm postgres_db
</span></span></code></pre></div><p>Now run the same command with port forwarding.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --name postgres_db -e POSTGRES_PASSWORD<span style=color:#f92672>=</span>mypassword -dp 127.0.0.1:5432:5432 postgres
</span></span></code></pre></div><p>This allows connecting to this database with external clients (For example <a href=https://github.com/dbcli/pgcli>pgcli</a>, which has nice features like autocompletion, syntax highlighting and various output formats).</p><p>More importantly, you can access this database from application code such as JDBC or Golang&rsquo;s <code>pq</code> driver.</p><p>Now you can connect to it using pgcli, and can use the same credentials in application code as well.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>pgcli -h localhost -u postgres -d postgres
</span></span></code></pre></div><p>Again, the default database name is <code>postgres</code> and it can be customized with <code>POSTGRES_DB</code> variable, eg: <code>-e POSTGRES_DB=books</code>.</p><h2 id=using-volumes-for-persistent-storage>Using volumes for persistent storage</h2><p>Above technique does not save data when container is removed using <code>docker rm</code>. For that, we have to use volumes.</p><p>First create a volume using</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker volume create postgres-data
</span></span></code></pre></div><p>Pass this volume when running docker command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --name postgres_db -e POSTGRES_PASSWORD<span style=color:#f92672>=</span>mypassword -dp 127.0.0.1:5432:5432<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-v postgres-data:/var/lib/postgresql/data postgres
</span></span></code></pre></div><h2 id=using-docker-compose>Using docker compose</h2><p>All above steps look a little manual, because they are.</p><p>We can use docker compose instead of specifying long commands every time. It also makes it easy to use other tools. To use docker compose, create a <code>docker-compose.yml</code> file with this configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.9&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>mysecretpassword</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgres-data:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>5432</span>:<span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres-data</span>:
</span></span></code></pre></div><p>Replace <code>mysecretpassword</code> by a password for local database. You can also refer to an environment variable in the configuration, which is arguably better than putting password in YAML.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>	<span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>		<span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#e6db74>&#34;${POSTGRES_PASSWORD}&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>## run `export POSTGRES_PASSWORD=mypassword` in shell</span>
</span></span></code></pre></div><p>After creating config, postgres server can be created by running the following command in the same directory as <code>docker-compose.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose up -d
</span></span></code></pre></div><p>To stop and remove the containers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose down
</span></span></code></pre></div><p>To delete storage volumes associated with the container, you should run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose down --volumes
</span></span></code></pre></div><h2 id=miscellaneous>Miscellaneous</h2><p>Golang <code>pq</code> driver requires to disable SSL explicitly. Add <code>sslmode=disable</code> in connection string when applicable to local setup.</p><p>Official docs also show using <code>adminer</code> in same compose file. Adminer (formerly <code>PhpMyAdmin</code>) is a popular web UI for many databases including postgres. To run adminer, add another service to the compose file. It will be available on <code>localhost:8080</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.9&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e>## ..postgres service from above config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>adminer</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>adminer</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>ADMINER_DEFAULT_SERVER</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>8080</span>:<span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## .. volumes from above config</span>
</span></span></code></pre></div><p>Many things can be configured using environment variables, refer to <a href=https://hub.docker.com/_/postgres>official documentation</a> for more details.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/docker>docker</a></li><li><a href=/tags/postgres>postgres</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/mahesh-hegde title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/never_inline/ title=Twitter><i data-feather=twitter></i></a>
<a class=border></a><a class=soc href=https://www.linkedin.com/in/mahesh-bhaskar-hegde title=LinkedIn><i data-feather=linkedin></i></a>
<a class=border></a></div><div class=footer-info>2023 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>